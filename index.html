<html>
  <head>
    <title>David-Niek Leaflet</title>  
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="main.css"/>
  </head>
  <body>
    <H1>Leaflet Map David Krijgsman & Niek Koelewijn</H1>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-hash/0.2.1/leaflet-hash.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.5/proj4.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.js"></script>
	<script>
	// variable RDnew
	const RDnew = new L.Proj.CRS('EPSG:28992', '+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +towgs84=565.2369,50.0087,465.658,-0.406857330322398,0.350732676542563,-1.8703473836068,4.0812 +no_defs',
    {
        transformation: L.Transformation(-1, -1, 0, 0),
        resolutions: [3440.640, 1720.320, 860.160, 430.080, 215.040, 107.520, 53.760, 26.880, 13.440, 6.720, 3.360, 1.680, 0.840, 0.420],
        origin: [-285401.920, 903401.920],
        bounds: L.bounds([-285401.920, 903401.920], [595401.920, 22598.080])
    }
);
	// initialize the map
	const map = L.map('map', {
	crs:RDnew,
	zoom:10,
	center: [51.9741, 5.6688]
	});
	
	// use PDOK achtergrondkaart
	const pdokachtergrondkaart = new L.TileLayer('https://service.pdok.nl/brt/achtergrondkaart/wmts/v2_0/standaard/EPSG:28992/{z}/{x}/{y}.png', {
    minZoom: 0,
    maxZoom: 13,
    attribution: 'Kaartgegevens: Â© <a href="http://www.cbs.nl">CBS</a>, <a href="http://www.kadaster.nl">Kadaster</a>, <a href="http://openstreetmap.org">OpenStreetMap</a><span class="printhide">-auteurs (<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>).</span>'
});

pdokachtergrondkaart.addTo(map);

	// ADD a WMS layer
	const cbs = L.tileLayer.wms('https://geodata.nationaalgeoregister.nl/ahn3/wms', {
        'layers': 'ahn3_5m_dtm',
        'styles': 'ahn3:ahn3_5m_detail',
        'srs': 'EPSG:28992',
        'format': 'image/png',
        'transparent': true,
		'opacity': 0.5
    }).addTo(map);
	
	// hash in URL
	const hash = new L.Hash(map);
	
	let marker = L.marker([51.98514, 5.66647]).addTo(map);
	let popuporion = "Campus Orion"
	marker.bindPopup(popuporion);
	
	let forum = L.marker([ 51.98531, 5.66361]).addTo(map);
	let popupforum = "Campus Forum";
	forum.bindPopup(popupforum); 

	let circle =  L.circle([51.98531, 5.66361], 500, {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.2
		}).addTo(map);
		
	const myGeojson = {
	  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              5.584455728530884,
              51.95484531418707
            ],
            [
              5.584369897842407,
              51.95487837413445
            ],
            [
              5.584380626678466,
              51.9549643298835
            ],
            [
              5.58429479598999,
              51.95503706154248
            ],
            [
              5.584166049957275,
              51.95502383761324
            ],
            [
              5.584112405776977,
              51.954951105932835
            ],
            [
              5.584144592285156,
              51.95481225421534
            ],
            [
              5.584005117416382,
              51.95443536881461
            ],
            [
              5.583758354187012,
              51.954190722209724
            ],
            [
              5.583672523498535,
              51.954025419694
            ],
            [
              5.583597421646117,
              51.953820443728155
            ],
            [
              5.583704710006714,
              51.95372126147279
            ],
            [
              5.583876371383667,
              51.95359563030107
            ],
            [
              5.583951473236084,
              51.95349644754845
            ],
            [
              5.583983659744263,
              51.95334436690165
            ],
            [
              5.584176778793335,
              51.95332453025751
            ],
            [
              5.584337711334228,
              51.953357591326196
            ],
            [
              5.5845630168914795,
              51.9534501621888
            ],
            [
              5.584841966629028,
              51.95349644754845
            ],
            [
              5.585163831710815,
              51.953555957226364
            ],
            [
              5.5854105949401855,
              51.953489835357146
            ],
            [
              5.585496425628662,
              51.95341048898537
            ],
            [
              5.585507154464722,
              51.95331791804086
            ],
            [
              5.585619807243347,
              51.953284856942936
            ],
            [
              5.585716366767882,
              51.953298081385036
            ],
            [
              5.585759282112122,
              51.95325179582061
            ],
            [
              5.585871934890747,
              51.953225346905214
            ],
            [
              5.585888028144836,
              51.95301044888931
            ],
            [
              5.585995316505432,
              51.95287820344452
            ],
            [
              5.586091876029968,
              51.95288481572602
            ],
            [
              5.586156249046326,
              51.95285836659414
            ],
            [
              5.586215257644653,
              51.95274265145882
            ],
            [
              5.586376190185547,
              51.95273603915637
            ],
            [
              5.586451292037964,
              51.95277571295653
            ],
            [
              5.586462020874023,
              51.95281869286712
            ],
            [
              5.586526393890381,
              51.952815386721596
            ],
            [
              5.5865854024887085,
              51.95276910065894
            ],
            [
              5.586620271205901,
              51.95274843722269
            ],
            [
              5.586923360824585,
              51.95279224369626
            ],
            [
              5.587164759635925,
              51.952831917446694
            ],
            [
              5.587486624717712,
              51.95303689793145
            ],
            [
              5.587443709373474,
              51.95304681631825
            ],
            [
              5.587867498397827,
              51.953476610971606
            ],
            [
              5.5878835916519165,
              51.95356918158849
            ],
            [
              5.5879586935043335,
              51.95365513984736
            ],
            [
              5.587942600250244,
              51.953751016172454
            ],
            [
              5.588023066520691,
              51.95387003477355
            ],
            [
              5.588039159774779,
              51.95407170445983
            ],
            [
              5.588210821151733,
              51.95422708868139
            ],
            [
              5.5878835916519165,
              51.954689932107954
            ],
            [
              5.587647557258605,
              51.954736216187825
            ],
            [
              5.58755099773407,
              51.95479241822059
            ],
            [
              5.587518811225891,
              51.954818866211646
            ],
            [
              5.587175488471984,
              51.9548750681408
            ],
            [
              5.586408376693726,
              51.95520566629811
            ],
            [
              5.586220622062683,
              51.95518087152089
            ],
            [
              5.58505117893219,
              51.95500730769625
            ],
            [
              5.584573745727539,
              51.95498747178778
            ],
            [
              5.584670305252075,
              51.95489159810656
            ],
            [
              5.584504008293151,
              51.954818866211646
            ],
            [
              5.584455728530884,
              51.95484531418707
            ]
          ]
        ]
      }
    }
  ]
	}
	
	// add geojson to map
	L.geoJSON(myGeojson).addTo(map);

	// Create a marker style
	const geojsonMarkerOptions = {
	radius: 8,
	fillColor: "#ff7800",
	color: "#000",
	weight: 1,
	opacity: 1,
	fillOpacity: 0.8
};

	//create a empty geojson layer
	const geojson = L.geoJson(null,{
	pointToLayer: function (feature, latlng) {
	return L.circleMarker(latlng, geojsonMarkerOptions);
  }
})

geojson.addTo(map);

	// Fetch the geojson file
	fetch("https://raw.githubusercontent.com/NieneB/webmapping_for_beginners_v2/master/leaflet-part-4/trafic_accidents_wageningen_2017.geojson")
    .then(response => response.json())
    .then(data => {
        geojson.addData(data);
    }).catch( error => alert("Sorry, the data cannot be found, this is the error: " + error))

 // Create a marker function
function geojsonMarkerFunction(feature) {
  return {
    radius: Math.log(feature.properties.AANTAL) +2,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
  }
};

	</script>
  </body>
</html>

